
<html lang="ja"><head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>😸</text></svg>">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">

  <title>へのにっき</title>
  <link rel="stylesheet" href="style.css"> 
</head>
<body>
  <div id="controls">
    <div id="yearControl">
      <button id="prevYear">◀</button>
      <span id="currentYear"></span>
      <button id="nextYear">▶</button>
    </div>
  </div>

  <table id="diaryTable">
    <thead>
      <tr>
        <th>日付</th>
        <th>曜日</th>
        <th>祝祭日</th>
        <th>どうした</th>
      </tr>
    </thead>
    <tbody id="diaryBody"></tbody>
  </table>

    <script>

    let entrydata = {};
    const holidays = [
    { date: "2023-01-01", name: "元旦" },
    { date: "2023-01-09", name: "成人の日" },
    { date: "2023-02-11", name: "建国記念の日" },
    { date: "2023-02-23", name: "天皇誕生日" },
    { date: "2023-03-21", name: "春分の日" },
    { date: "2023-04-29", name: "昭和の日" },
    { date: "2023-05-03", name: "憲法記念日" },
    { date: "2023-05-04", name: "みどりの日" },
    { date: "2023-05-05", name: "こどもの日" },
    { date: "2023-07-17", name: "海の日" },
    { date: "2023-08-11", name: "山の日" },
    { date: "2023-09-18", name: "敬老の日" },
    { date: "2023-09-23", name: "秋分の日" },
    { date: "2023-10-09", name: "スポーツの日" },
    { date: "2023-11-03", name: "文化の日" },
    { date: "2023-11-23", name: "勤労感謝の日" },
    { date: "2024-01-01", name: "元旦" },
    { date: "2024-01-08", name: "成人の日" },
    { date: "2024-02-11", name: "建国記念の日" },
    { date: "2024-02-12", name: "振替休日" },
    { date: "2024-02-23", name: "天皇誕生日" },
    { date: "2024-03-20", name: "春分の日" },
    { date: "2024-04-29", name: "昭和の日" },
    { date: "2024-05-03", name: "憲法記念日" },
    { date: "2024-05-04", name: "みどりの日" },
    { date: "2024-05-05", name: "こどもの日" },
    { date: "2024-05-06", name: "振替休日" },
    { date: "2024-07-15", name: "海の日" },
    { date: "2024-08-11", name: "山の日" },
    { date: "2024-08-12", name: "振替休日" },
    { date: "2024-09-16", name: "敬老の日" },
    { date: "2024-09-22", name: "秋分の日" },
    { date: "2024-09-23", name: "振替休日" },
    { date: "2024-10-14", name: "スポーツの日" },
    { date: "2024-11-03", name: "文化の日" },
    { date: "2024-11-04", name: "振替休日" },
    { date: "2024-11-23", name: "勤労感謝の日" },
    { date: "2024-12-28", name: "年末年始休暇" },
    { date: "2024-12-29", name: "年末年始休暇" },
    { date: "2024-12-30", name: "年末年始休暇" },
    { date: "2024-12-31", name: "年末年始休暇" },
    { date: "2025-01-01", name: "元日" },
    { date: "2025-01-02", name: "年末年始休暇" },
    { date: "2025-01-03", name: "年末年始休暇" },
    { date: "2025-01-04", name: "年末年始休暇" },
    { date: "2025-01-05", name: "年末年始休暇" },
    { date: "2025-01-13", name: "成人の日" },
    { date: "2025-02-11", name: "建国記念の日" },
    { date: "2025-02-23", name: "天皇誕生日" },
    { date: "2025-02-24", name: "振替休日" },
    { date: "2025-03-20", name: "春分の日" },
    { date: "2025-04-29", name: "昭和の日" },
    { date: "2025-05-03", name: "憲法記念日" },
    { date: "2025-05-04", name: "みどりの日" },
    { date: "2025-05-05", name: "こどもの日" },
    { date: "2025-05-06", name: "振替休日" },
    { date: "2025-07-21", name: "海の日" },
    { date: "2025-08-11", name: "山の日" },
    { date: "2025-09-15", name: "敬老の日" },
    { date: "2025-09-23", name: "秋分の日" },
    { date: "2025-10-13", name: "スポーツの日" },
    { date: "2025-11-03", name: "文化の日" },
    { date: "2025-11-23", name: "勤労感謝の日" },
    { date: "2025-11-24", name: "振替休日" },
    { date: "2025-12-29", name: "年末年始休暇" },
    { date: "2025-12-30", name: "年末年始休暇" },
    { date: "2025-12-31", name: "年末年始休暇" },
    { date: "2026-01-01", name: "元日" },
    { date: "2026-01-02", name: "年末年始休暇" },
    { date: "2026-01-03", name: "年末年始休暇" },
    { date: "2026-01-04", name: "年末年始休暇" },
    { date: "2026-01-12", name: "成人の日" },
    { date: "2026-01-01", name: "元日" },
    { date: "2026-01-12", name: "成人の日" },
    { date: "2026-02-11", name: "建国記念の日" },
    { date: "2026-02-23", name: "天皇誕生日" },
    { date: "2026-03-20", name: "春分の日" },
    { date: "2026-04-29", name: "昭和の日" },
    { date: "2026-05-03", name: "憲法記念日" },
    { date: "2026-05-04", name: "みどりの日" },
    { date: "2026-05-05", name: "こどもの日" },
    { date: "2026-05-06", name: "振替休日" },
    { date: "2026-07-20", name: "海の日" },
    { date: "2026-08-11", name: "山の日" },
    { date: "2026-09-21", name: "敬老の日" },
    { date: "2026-09-22", name: "国民の休日" },
    { date: "2026-09-23", name: "秋分の日" },
    { date: "2026-10-12", name: "スポーツの日" },
    { date: "2026-11-03", name: "文化の日" },
    { date: "2026-11-23", name: "勤労感謝の日" },
    { date: "2027-01-01", name: "元日" },
    { date: "2027-01-11", name: "成人の日" },
    { date: "2027-02-11", name: "建国記念の日" },
    { date: "2027-02-23", name: "天皇誕生日" },
    { date: "2027-03-21", name: "春分の日" },
    { date: "2027-03-22", name: "振替休日" },
    { date: "2027-04-29", name: "昭和の日" },
    { date: "2027-05-03", name: "憲法記念日" },
    { date: "2027-05-04", name: "みどりの日" },
    { date: "2027-05-05", name: "こどもの日" },
    { date: "2027-07-19", name: "海の日" },
    { date: "2027-08-11", name: "山の日" },
    { date: "2027-09-20", name: "敬老の日" },
    { date: "2027-09-23", name: "秋分の日" },
    { date: "2027-10-11", name: "スポーツの日" },
    { date: "2027-11-03", name: "文化の日" },
    { date: "2027-11-23", name: "勤労感謝の日" },
    { date: "2028-01-01", name: "元日" },
    { date: "2028-01-10", name: "成人の日" },
    { date: "2028-02-11", name: "建国記念の日" },
    { date: "2028-02-23", name: "天皇誕生日" },
    { date: "2028-03-20", name: "春分の日" },
    { date: "2028-04-29", name: "昭和の日" },
    { date: "2028-05-03", name: "憲法記念日" },
    { date: "2028-05-04", name: "みどりの日" },
    { date: "2028-05-05", name: "こどもの日" },
    { date: "2028-07-17", name: "海の日" },
    { date: "2028-08-11", name: "山の日" },
    { date: "2028-09-18", name: "敬老の日" },
    { date: "2028-09-22", name: "秋分の日" },
    { date: "2028-10-09", name: "スポーツの日" },
    { date: "2028-11-03", name: "文化の日" },
    { date: "2028-11-23", name: "勤労感謝の日" },
    { date: "2029-01-01", name: "元日" },
    { date: "2029-01-08", name: "成人の日" },
    { date: "2029-02-11", name: "建国記念の日" },
    { date: "2029-02-12", name: "振替休日" },
    { date: "2029-02-23", name: "天皇誕生日" },
    { date: "2029-03-20", name: "春分の日" },
    { date: "2029-04-29", name: "昭和の日" },
    { date: "2029-04-30", name: "振替休日" },
    { date: "2029-05-03", name: "憲法記念日" },
    { date: "2029-05-04", name: "みどりの日" },
    { date: "2029-05-05", name: "こどもの日" },
    { date: "2029-07-16", name: "海の日" },
    { date: "2029-08-11", name: "山の日" },
    { date: "2029-09-17", name: "敬老の日" },
    { date: "2029-09-23", name: "秋分の日" },
    { date: "2029-09-24", name: "振替休日" },
    { date: "2029-10-08", name: "スポーツの日" },
    { date: "2029-11-03", name: "文化の日" },
    { date: "2029-11-23", name: "勤労感謝の日" },
    { date: "2030-01-01", name: "元日" },
    { date: "2030-01-14", name: "成人の日" },
    { date: "2030-02-11", name: "建国記念の日" },
    { date: "2030-02-23", name: "天皇誕生日" },
    { date: "2030-03-20", name: "春分の日" },
    { date: "2030-04-29", name: "昭和の日" },
    { date: "2030-05-03", name: "憲法記念日" },
    { date: "2030-05-04", name: "みどりの日" },
    { date: "2030-05-05", name: "こどもの日" },
    { date: "2030-05-06", name: "振替休日" },
    { date: "2030-07-15", name: "海の日" },
    { date: "2030-08-11", name: "山の日" },
    { date: "2030-08-12", name: "振替休日" },
    { date: "2030-09-16", name: "敬老の日" },
    { date: "2030-09-23", name: "秋分の日" },
    { date: "2030-10-14", name: "スポーツの日" },
    { date: "2030-11-03", name: "文化の日" },
    { date: "2030-11-04", name: "振替休日" },
    { date: "2030-11-23", name: "勤労感謝の日" },
  ];

    const dayNames = ["日", "月", "火", "水", "木", "金", "土"];
    let currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let activeDays = new Set([0, 1, 2, 3, 4, 5, 6]);
    const yearControl = document.getElementById("yearControl");
    const diaryBody = document.getElementById("diaryBody");
    async function loadFromJSON() {
      try {
        const response = await fetch('backupData.json');
        const parsed = await response.json();
        // LocalStorageのデータとJSONのデータを統合
        for (let key in parsed) {
          if (!entrydata[key] || entrydata[key] === "") {
            entrydata[key] = parsed[key];
          }
        }
        saveToLocalStorage();
      } catch (e) {
        console.error("JSONデータの読み込みに失敗", e);
      }
    }


    function loadFromLocalStorage() {
      const savedData = localStorage.getItem("diaryData");
      if (savedData) {
        entrydata = JSON.parse(savedData);
      }
    }

    function saveToLocalStorage() {
      localStorage.setItem("diaryData", JSON.stringify(entrydata));
    }

    function filterTable() {
      const rows = document.querySelectorAll("#diaryBody tr");

      rows.forEach((row) => {
        const dayOfWeek = row.cells[1].textContent;
        const dayIndex = dayNames.indexOf(dayOfWeek);
        const contentCell = row.cells[3];
        const content = contentCell.textContent.toLowerCase();

        const matchDay = activeDays.has(dayIndex);

        if (matchDay) {
          row.classList.remove("hidden");

          contentCell.textContent = contentCell.textContent;
        } else {
          row.classList.add("hidden");
        }
      });
    }
    function loadYear(year) {
      currentYear = year;

      const table = document.getElementById("diaryBody");
      table.innerHTML = "";

      const startDate = new Date(year, 0, 1);
      const endDate = new Date(year, 11, 31);

      for (
        let d = new Date(startDate);
        d <= endDate;
        d.setDate(d.getDate() + 1)
      ) {
        const row = table.insertRow();
        const dateCell = row.insertCell(0);
        const dayCell = row.insertCell(1);
        const holidayCell = row.insertCell(2);
        const contentCell = row.insertCell(3);

        const formattedDate = `${d.getFullYear()}-${(d.getMonth() + 1)
          .toString()
          .padStart(2, "0")}-${d.getDate().toString().padStart(2, "0")}`;
        dateCell.textContent = formattedDate;
        dayCell.textContent = dayNames[d.getDay()];

        contentCell.className = "editable";
        contentCell.contentEditable = true;
        contentCell.textContent = entrydata[formattedDate] || "";

        if (d.getDay() === 0) {
          row.classList.add("sunday");
        } else if (d.getDay() === 6) {
          row.classList.add("saturday");
        }

        const holiday = holidays.find((h) => h.date === formattedDate);
        if (holiday) {
          row.classList.add("holiday");
          holidayCell.textContent = holiday.name;
        }
      }

      filterTable();
      const today = new Date();
      const todayFormatted = `${today.getFullYear()}-${(today.getMonth() + 1)
        .toString()
        .padStart(2, "0")}-${today.getDate().toString().padStart(2, "0")}`;
      const todayRow = Array.from(table.getElementsByTagName("tr")).find(
        (row) => row.cells[0].textContent === todayFormatted
      );
      document.getElementById("currentYear").textContent = year;
      if (todayRow) {
        todayRow.scrollIntoView({ behavior: "smooth", block: "center" });
        todayRow.style.transition = "background-color 1s";
        todayRow.style.backgroundColor = "#ffeb3b50";
        setTimeout(() => {
          todayRow.style.backgroundColor = "";
        }, 2000);
      }
    }

    document
      .getElementById("prevYear")
      .addEventListener("click", () => loadYear(currentYear - 1));
    document
      .getElementById("nextYear")
      .addEventListener("click", () => loadYear(currentYear + 1));

    document.getElementById("diaryBody").addEventListener("input", (e) => {
      if (e.target.className === "editable") {
        const row = e.target.parentElement;
        const date = row.cells[0].textContent;
        const content = e.target.textContent;
        entrydata[date] = content;
        saveToLocalStorage();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key === "s") {
        e.preventDefault();
        const dataToCopy = JSON.stringify(entrydata);
        navigator.clipboard
          .writeText(dataToCopy)
          .then(() => {
            showToast("最新のデータをクリップボードにコピーしました！");
          })
          .catch((err) => {
            showToast("コピーに失敗しました: " + err);
          });
        setTimeout(() => {
          location.href = "https://github.com/buzomo/toh-diary/edit/main/index.html";
        }, 3000);
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      loadFromLocalStorage();
      loadFromJSON();
      loadYear(currentYear);
    });
  </script>


</body></html>
